#!/bin/bash

set -o nounset -o pipefail

CHECK_DIRS="$1"
CLAMSCAN_FLAGS="$2"
CLAMSCAN_LOG=$(mktemp)

# Date the clam_logs
echo "All scans in this log started $(date)" > "$CLAMSCAN_LOG"

# Start Scanning
echo === Scanning working and .git directories...
clamscan ${CLAMSCAN_FLAGS} ${CHECK_DIRS} >> "$CLAMSCAN_LOG"  
SCAN_RETURN_CODE=$?
echo === Finished


# Report output.
fail_checks=0
if [ ${SCAN_RETURN_CODE} -ne 0 ]; then
	echo === Malware Scanning failed!
    cat "$CLAMSCAN_LOG"
	fail_checks=1
else
   echo === No Malware Found!  
fi

rm ${CLAMSCAN_LOG}

exit ${fail_checks}
