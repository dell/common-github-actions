# Copyright (c) 2025 Dell Inc., or its subsidiaries. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0

# Reusable workflow to update Dell packages to the latest released version on CSM based projects
name: Update Dell Packages to Latest Released

on:
  workflow_call:

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    steps:

        - name: Checkout repository
          uses: actions/checkout@v2
  
        - name: Install skopeo
          run: |
            if ! command -v skopeo &> /dev/null
            then
                sudo apt-get update
                sudo apt-get install -y skopeo
            fi
  
        - name: Get UBI Micro Image Digest
          id: get-digest
          run: |
            digest=$(skopeo inspect docker://registry.access.redhat.com/ubi9/ubi-micro:latest | jq -r '.Digest')
            echo "Digest: $digest"
            echo "::set-output name=digest::$digest"
  
        - name: Print Digest
          run: echo "The latest UBI micro image digest is ${{ steps.get-digest.outputs.digest }}"